{% extends 'base.html' %}
{% load static %}
{% load abyssal_types %}
{% load humanize %}
{% block content %}
<div class="jumbotron">
<h1>What the hell is this?</h1>

<p class="lead"> Welcome to <a
href="https://mutaplasmid.space/">mutaplasmid.space</a>! This is a
community-built website to facilitate the trading of abyssal modules in EVE
Online. With the current contract system, it's hard to find and buy the right
modules for your spaceship. This service aims to provide you with tools to
efficiently search for the abyssal modules you want. </p>

<p>Once you've find a module you like there are two ways to open the contract
in the EVE client. Firstly, you can click the "log in" button in the top right
and then the "ESI" button on any abyssal module to immediately open it in-game.
If you don't want to sign in via EVE SSO you can click the "Link" button which
will copy some data to your clipboard. You can paste this data into your
in-game notepad and then click the newly created link to view the
contract.</p>

</div>

<div class="jumbotron">
<h1>Module Types</h1>

<div class="container">
    {% get_abyssal_type_list as type_list %}
    {% for r, l in type_list %}
    <div class="row">
        <div class="col-md-3 col-12 align-middle">
            <img height="21px" src="https://image.eveonline.com/Type/{{ l.0.1 }}_32.png"> {{ r }}
        </div>
        <div class="col-md-9 col-12 row mx-0 p-1">
            {% for n, i in l %}
            <div class="col-{{ l|column_width }} p-1"><a class="btn btn-sm btn-block btn-primary" href="{% url 'abyssal_modules:type_module_list' i %}">{{ n }}</a></div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>

</div>


<div class="jumbotron">
    <h1>Latest Abyssal Modules</h1>

    <table class="table module-table dt-responsive" id="module-table" width="100%">
        <thead>
            <tr>
                <th data-priority="1" width="1px">Icon</th>
                <th data-priority="11000">Module</th>
                <th data-priority="2">Attributes</th>
                <th data-priority="10500" width="120px">Price</th>
                <th data-priority="9500" width="1px">Open</th>
            </tr>
        </thead>
        <tbody>
            {% for m in modules %}
            <tr class="item">
                <td><a href="{% url 'abyssal_modules:module_view' m.id %}"><img src="https://image.eveonline.com/Type/{{ m.type.id }}_32.png"></a></td>
                <td><a href="{% url 'abyssal_modules:type_module_list' m.type.id %}">{{ m.type.name }}</a></td>
                <td>
                    <div class="row">
                        {% for a in m.attribute_list %}
                        <div class="col-12 col-md-4">
                            <img src="{% static a.attribute.icon_path %}" title="{{ a.attribute.name }}">
                            {{ a.real_value|floatformat }} {{ a.attribute.unit_str }}
                        </div>
                        {% endfor %}
                    </div>
                </td>
                <td data-sort="{{ m.contract_price }}">
                    {{ m.contract_price|intword }} ISK
                    {% if not m.contract_single %}<span class="text-muted" title="This contract includes other items">M</span>{% endif %}
                    {% if m.contract_auction %}<span class="text-muted" title="This is an auction. Price may be delayed by up to 30 minutes.">A</span>{% endif %}
                </td>
                <td class="contract-button-container">
                    <button
                        class="btn btn-primary btn-open-contract-esi btn-open-contract"
                        data-contract-id="{{ m.contract_id }}"
                        {% if not request.user.is_authenticated %}disabled{% endif %}
                    >
                        ESI
                    </button>&nbsp;
                    <button
                        class="btn btn-primary btn-copy-contract-link btn-open-contract"
                        data-clipboard-text="<url=contract:30000142//{{ m.contract_id }}>Contract {{ m.contract_id }}</url>"
                    >
                        Link
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block trailing_js %}
<script>
$(document).ready(function () {
    $('#module-table').DataTable({
        "columnDefs": [
            { "orderable": false, "targets": 0 },
            { "orderable": false, "targets": 2 },
            { "orderable": false, "targets": 4 },
        ],
        "order": []
    });
});
</script>
{% endblock %}
